---
title: "kdobson_viz"
author: "Ken Dobson"
date: "30/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r, fig.width = 10}
data <- read.csv("Data visualization final data.csv") %>% 
  janitor::clean_names()

#change name
colnames(data)[1] <- "country"

#select time
data1 <- data %>% 
  select(country:series_code,x2000_yr2000:x2020_yr2020)

#change names
colnames(data1)[5:25] <- c(2000:2020)

#pivot longer
data2 <- tidyr::pivot_longer(data1, cols = "2000":"2020", names_to = "Year", values_to = "count")

#set the missing data as NA
data2[data2 == ".."] <- NA

#add continent information
data2$continent <- countrycode(sourcevar = data2$country,
                               origin = "country.name",
                               destination = "continent")
#data2 taken from clean_data_1
data_clean <- data2 %>%
  filter(series != "") %>% 
    mutate(Year = as.integer(Year),
         count = as.double(count)) %>% 
    select(-series_code)
```

```{r}

pisa <- data_clean %>% 
  filter(grepl("PISA: Mean performance on the reading scale", 
               series, fixed = TRUE) | 
           grepl("GDP per capita", series, fixed = TRUE), 
         !is.na(count), Year == '2018') %>% 
  pivot_wider(names_from = series, values_from =count) %>% 
  rename(GDP_per_cap = `GDP per capita (current US$)`,
         GDP_per_cap_PPP = `GDP per capita, PPP (current international $)`,
         mean_score = `PISA: Mean performance on the reading scale`,
         male_score = `PISA: Mean performance on the reading scale. Male`,
         female_score = `PISA: Mean performance on the reading scale. Female`
         ) %>% 
  #only countries, with scores, Kosovo has no continent so remove the data
  filter(!is.na(mean_score), country != 'Kosovo') %>% 
  mutate(highlight = ifelse(country %in% c("China", "Luxembourg", "Morocco", "Vietnam"), TRUE, FALSE),
         c_label = ifelse(country %in% c("China", "Luxembourg", "Morocco", "Vietnam"), country, ""))

```

```{r}

ggplot(pisa, aes(x = GDP_per_cap, y = mean_score, colour = highlight, label = c_label)) + 
  geom_point() +
  ggrepel::geom_text_repel() +
  labs(y = "PISA Reading Score", x = "GDP per Capita", 
       title = "Money can help improve education but it's not the only factor",
       subtitle = "China and Vietnam excel with low GDP per capita",
       caption = "Source : worldbank.org/education") +
  scale_colour_manual(values = c("grey","#C0392B")) +
  theme(plot.title = element_text(face = "bold", size = 19, family = "Oswald"),
      legend.title = element_text(family = "Oswald"),
      legend.position = 'none',
      plot.subtitle=element_text(size=17, family = "Oswald"),
      plot.caption = element_text(size=9 , family = "Oswald"),
      axis.text.x = element_text(size= 11, family='Oswald',color="black"),
      axis.text.y = element_text(size= 11,family = "Oswald",color="black"),
      axis.title.x = element_text(size= 11, family='Oswald',color="black"),
      axis.title.y = element_text(size= 11,family = "Oswald",color="black"),
      plot.title.position = "plot",
      plot.caption.position = "plot",
      panel.grid = element_blank(),
      panel.background = element_rect(fill = 'white', colour = 'white'),
      axis.ticks = element_blank())

  


```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
pivot <- data_clean %>% 
  pivot_wider(names_from = series, values_from = count)
model_data <- data_clean %>% 
  pivot_wider(names_from = series, values_from = count) %>% 
  select(country, Year,
         lit_rate = `Adult literacy rate, population 15+ years, both sexes (%)`,
         edu_spend = `Government expenditure on primary education, US$ (millions)`,
         enrolment_rate = `Total net enrolment rate, primary, both sexes (%)`,
         enrolment_ratio = `Gross enrolment ratio, primary and lower secondary, both sexes (%)`,
         out_of_school = `Rate of out-of-school children of primary school age, both sexes (%)`,
         early_ed = `Gross enrolment ratio, early childhood education, both sexes (%)`,
         prim_comp = `Primary completion rate, both sexes (%)`,
         govt_exp_perc = `Government expenditure on education as % of GDP (%)`
         )
skimr::skim(pivot)

head(model_data, 50)

model_data[complete.cases(model_data),]

model1 <- lm(lit_rate ~ edu_spend + enrolment_rate + enrolment_ratio + 
               out_of_school + early_ed + govt_exp_perc, model_data)
summary(model1)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
